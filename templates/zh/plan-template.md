---
description: "功能开发的实现计划模板"
scripts:
  sh: scripts/bash/update-agent-context.sh __AGENT__
  ps: scripts/powershell/update-agent-context.ps1 -AgentType __AGENT__
---

# 实现计划：[功能]

**分支**：`[###-feature-name]` | **日期**：[日期] | **规范**：[链接]
**输入**：来自`/specs/[###-feature-name]/spec.md`的功能规范

## 执行流程（/plan命令范围）
```
1. 从输入路径加载功能规范
   → 如果未找到：错误"在{path}处没有功能规范"
2. 填写技术上下文（扫描需要澄清的内容）
   → 从上下文检测项目类型（web=前端+后端，mobile=应用+api）
   → 根据项目类型设置结构决策
3. 根据宪法文档内容填写宪法检查部分。
4. 评估下面的宪法检查部分
   → 如果存在违规：在复杂度跟踪中记录
   → 如果无法合理化：错误"首先简化方法"
   → 更新进度跟踪：初始宪法检查
5. 执行阶段0 → research.md
   → 如果仍有需要澄清的内容：错误"解决未知问题"
6. 执行阶段1 → contracts、data-model.md、quickstart.md、特定代理模板文件（例如，Claude Code的`CLAUDE.md`，GitHub Copilot的`.github/copilot-instructions.md`，或Gemini CLI的`GEMINI.md`）。
7. 重新评估宪法检查部分
   → 如果有新违规：重构设计，返回阶段1
   → 更新进度跟踪：设计后宪法检查
8. 规划阶段2 → 描述任务生成方法（不创建tasks.md）
9. 停止 - 准备/tasks命令
```

**重要**：/plan命令在步骤7停止。阶段2-4由其他命令执行：
- 阶段2：/tasks命令创建tasks.md
- 阶段3-4：实现执行（手动或通过工具）

## 摘要
[从功能规范中提取：主要需求 + 来自研究的技术方法]

## 技术上下文
**语言/版本**：[例如 Java 17、Python 3.11、Node.js 18 或需要澄清]  
**主要依赖**：[例如 Spring Boot、Vue.js、MyBatis、Element Plus 或需要澄清]  
**存储**：[如适用，例如 MySQL、Redis、MongoDB、本地文件 或不适用]  
**测试**：[例如 JUnit、Jest、Pytest、Cypress 或需要澄清]  
**目标平台**：[例如 Linux服务器、微信小程序、Android/iOS、H5页面 或需要澄清]
**项目类型**：[单体应用/前后端分离/小程序/移动App - 决定架构结构]  
**性能目标**：[业务相关，例如 支持1000并发用户、响应时间<200ms、支持10万条数据查询 或需要澄清]  
**约束条件**：[技术限制，例如 必须支持IE11、离线使用、内存占用<100MB、符合等保二级 或需要澄清]  
**业务规模**：[用户规模，例如 预计1万注册用户、日活1000人、存储1TB数据 或需要澄清]
**特殊需求**：[中文环境特有，例如 微信支付集成、短信验证、实名认证、ICP备案 或需要澄清]

## 宪法检查
*门控：阶段0研究前必须通过。阶段1设计后重新检查。*

[根据宪法文件确定的门控]

## 项目结构

### 文档（此功能）
```
specs/[###-feature]/
├── plan.md              # 此文件（/plan命令输出）
├── research.md          # 阶段0输出（/plan命令）
├── data-model.md        # 阶段1输出（/plan命令）
├── quickstart.md        # 阶段1输出（/plan命令）
├── contracts/           # 阶段1输出（/plan命令）
└── tasks.md             # 阶段2输出（/tasks命令 - 不由/plan创建）
```

### 源代码（仓库根目录）
```
# 选项1：单一项目（默认）
src/
├── models/
├── services/
├── cli/
└── lib/

tests/
├── contract/
├── integration/
└── unit/

# 选项2：Web应用程序（检测到"前端" + "后端"时）
backend/
├── src/
│   ├── models/
│   ├── services/
│   └── api/
└── tests/

frontend/
├── src/
│   ├── components/
│   ├── pages/
│   └── services/
└── tests/

# 选项3：移动 + API（检测到"iOS/Android"时）
api/
└── [与上面的后端相同]

ios/ 或 android/
└── [平台特定结构]
```

**结构决策**：[默认选项1，除非技术上下文表明web/移动应用]

## 阶段0：大纲和研究
1. **从上面的技术上下文中提取未知项**：
   - 对于每个需要澄清的内容 → 研究任务
   - 对于每个依赖 → 最佳实践任务
   - 对于每个集成 → 模式任务

2. **生成和调度研究代理**：
   ```
   对于技术上下文中的每个未知项：
     任务："为{功能上下文}研究{未知项}"
   对于每个技术选择：
     任务："在{领域}中找到{技术}的最佳实践"
   ```

3. **在`research.md`中整合发现**，使用格式：
   - 决策：[选择了什么]
   - 理由：[为什么选择]
   - 考虑的替代方案：[还评估了什么]

**输出**：research.md，解决所有需要澄清的内容

## 阶段1：设计和合约
*先决条件：research.md完成*

1. **从功能规范中提取实体** → `data-model.md`：
   - 实体名称、字段、关系
   - 来自需求的验证规则
   - 如适用的状态转换

2. **从功能需求生成API合约**：
   - 对于每个用户动作 → 端点
   - 使用标准REST/GraphQL模式
   - 将OpenAPI/GraphQL模式输出到`/contracts/`

3. **从合约生成合约测试**：
   - 每个端点一个测试文件
   - 断言请求/响应模式
   - 测试必须失败（尚无实现）

4. **从用户故事中提取测试场景**：
   - 每个故事 → 集成测试场景
   - 快速开始测试 = 故事验证步骤

5. **增量更新代理文件**（O(1)操作）：
   - 为您的AI助手运行`{SCRIPT}`
   - 如果存在：仅添加当前计划中的新技术
   - 在标记之间保留手动添加
   - 更新最近更改（保留最后3个）
   - 保持在150行以下以提高令牌效率
   - 输出到仓库根目录

**输出**：data-model.md、/contracts/*、失败测试、quickstart.md、特定代理文件

## 阶段2：任务规划方法
*此部分描述/tasks命令将执行的内容 - 在/plan期间不执行*

**任务生成策略**：
- 加载`.specify/templates/tasks-template.md`作为基础
- 从阶段1设计文档（合约、数据模型、快速开始）生成任务
- 每个合约 → 合约测试任务[P]
- 每个实体 → 模型创建任务[P] 
- 每个用户故事 → 集成测试任务
- 实现任务以使测试通过

**排序策略**：
- TDD顺序：实现前测试 
- 依赖顺序：服务前模型，UI前服务
- 标记[P]用于并行执行（独立文件）

**预估输出**：tasks.md中25-30个编号、有序的任务

**重要**：此阶段由/tasks命令执行，不由/plan执行

## 阶段3+：未来实现
*这些阶段超出了/plan命令的范围*

**阶段3**：任务执行（/tasks命令创建tasks.md）  
**阶段4**：实现（按照宪法原则执行tasks.md）  
**阶段5**：验证（运行测试、执行quickstart.md、性能验证）

## 复杂度跟踪
*仅在宪法检查有必须合理化的违规时填写*

| 违规 | 为什么需要 | 拒绝更简单替代方案的原因 |
|-----------|------------|-------------------------------------|
| [例如第4个项目] | [当前需求] | [为什么3个项目不足] |
| [例如仓库模式] | [具体问题] | [为什么直接数据库访问不足] |


## 进度跟踪
*此检查清单在执行流程期间更新*

**阶段状态**：
- [ ] 阶段0：研究完成（/plan命令）
- [ ] 阶段1：设计完成（/plan命令）
- [ ] 阶段2：任务规划完成（/plan命令 - 仅描述方法）
- [ ] 阶段3：任务生成（/tasks命令）
- [ ] 阶段4：实现完成
- [ ] 阶段5：验证通过

**门控状态**：
- [ ] 初始宪法检查：通过
- [ ] 设计后宪法检查：通过
- [ ] 所有需要澄清的内容已解决
- [ ] 复杂度偏差已记录

---
*基于宪法v2.1.1 - 查看`/memory/constitution.md`*
