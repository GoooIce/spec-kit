# I18n 国际化支持

Specify CLI 现在支持多语言国际化，目前支持英语 (en) 和中文 (zh)。

## 架构设计

### 目录结构
```
src/specify_cli/
├── __init__.py (主文件)
├── i18n/
│   ├── __init__.py (i18n模块)
│   └── locales/
│       ├── en.json (英文翻译)
│       └── zh.json (中文翻译)
```

### 核心功能

- **自动语言检测**: 根据系统语言或环境变量自动选择语言
- **手动语言设置**: 支持通过命令行或代码设置语言
- **嵌套翻译键**: 支持 `errors.invalid_ai` 这样的嵌套键
- **参数插值**: 支持 `t('project_created', name='my-project')` 参数替换
- **回退机制**: 未找到翻译时回退到英文，最终回退到键名

## API 使用方法

### 基本翻译
```python
from specify_cli.i18n import t

# 简单翻译
message = t('welcome')

# 嵌套键翻译
error = t('errors.invalid_ai')
```

### 参数插值
```python
# 带参数的翻译
project_msg = t('project.created', name='my-project')
error_msg = t('errors.invalid_ai', ai='unknown', choices='claude, gemini')
```

### 语言设置
```python
from specify_cli.i18n import set_language, get_language

# 手动设置语言
set_language('zh')  # 切换到中文
set_language('en')  # 切换到英文

# 获取当前语言
current_lang = get_language()
```

## 翻译文件结构

翻译文件使用 JSON 格式，支持嵌套结构：

```json
{
  "tagline": "Spec-Driven Development Toolkit",
  "errors": {
    "not_found": "File not found",
    "invalid_ai": "Invalid AI assistant '{ai}'. Choose from: {choices}"
  },
  "project": {
    "created": "Project '{name}' created successfully"
  }
}
```

## 语言检测优先级

1. `SPECIFY_LANG` 环境变量
2. `LANG` 环境变量
3. 系统默认语言设置
4. 默认英文 (en)

## 扩展新语言

要添加新语言支持：

1. 在 `src/specify_cli/i18n/locales/` 目录下创建新的 JSON 文件 (如 `fr.json`)
2. 复制现有翻译文件的结构
3. 翻译所有键值对
4. 更新 `get_language_choices()` 函数添加新语言选项

## 注意事项

- 翻译键应使用小写字母和下划线
- 嵌套使用点号分隔 (`section.subsection.key`)
- 参数使用花括号 `{param_name}`
- 保持所有语言文件的键结构一致

## 测试验证

通过测试验证：
- ✅ 112个翻译键在英文和中文之间保持一致
- ✅ JSON 文件格式正确
- ✅ 嵌套键结构正确
- ✅ 参数插值功能正常
